<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Making a gas detector | Chirpy</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Making a gas detector" /><meta name="author" content="your_full_name" /><meta property="og:locale" content="en_US" /><meta name="description" content="Introduction My neighbor Alex sometimes has odorous gas coming out from the sewage pipes in his office. In order to show evidence to the office managers, he wants to deploy gas sensor in different rooms, collect data and finally generate graphs. Alex has already assembled the sensor boards, but he needs help with the programming and data collection. In this post, I introduce the hardware and software architectures that we have collectively come up with. This project was particularly interesting because it was my first opportunity to program an embedded platform." /><meta property="og:description" content="Introduction My neighbor Alex sometimes has odorous gas coming out from the sewage pipes in his office. In order to show evidence to the office managers, he wants to deploy gas sensor in different rooms, collect data and finally generate graphs. Alex has already assembled the sensor boards, but he needs help with the programming and data collection. In this post, I introduce the hardware and software architectures that we have collectively come up with. This project was particularly interesting because it was my first opportunity to program an embedded platform." /><link rel="canonical" href="https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/" /><meta property="og:url" content="https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/" /><meta property="og:site_name" content="Chirpy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-13T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Making a gas detector" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@your_full_name" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Introduction My neighbor Alex sometimes has odorous gas coming out from the sewage pipes in his office. In order to show evidence to the office managers, he wants to deploy gas sensor in different rooms, collect data and finally generate graphs. Alex has already assembled the sensor boards, but he needs help with the programming and data collection. In this post, I introduce the hardware and software architectures that we have collectively come up with. This project was particularly interesting because it was my first opportunity to program an embedded platform.","mainEntityOfPage":{"@type":"WebPage","@id":"https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/"},"@type":"BlogPosting","url":"https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/","headline":"Making a gas detector","dateModified":"2020-08-13T00:00:00+08:00","datePublished":"2020-08-13T00:00:00+08:00","author":{"@type":"Person","name":"your_full_name"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/photo_osc.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Chirpy</a></div><div class="site-subtitle font-italic">A text-focused Jekyll theme.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/categories/korean/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>KOREAN BLOG</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/categories/trading/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>TRADING</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>ALL CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/github_username" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['example','doamin.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Making a gas detector</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Making a gas detector</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Aug 13, 2020, 12:00 AM +0800" > Aug 13 <i class="unloaded">2020-08-13T00:00:00+08:00</i> </span> by <span class="author"> your_full_name </span></div></div><div class="post-content"><h3 id="introduction">Introduction</h3><p>My neighbor Alex sometimes has odorous gas coming out from the sewage pipes in his office. In order to show evidence to the office managers, he wants to deploy gas sensor in different rooms, collect data and finally generate graphs. Alex has already assembled the sensor boards, but he needs help with the programming and data collection. In this post, I introduce the hardware and software architectures that we have collectively come up with. This project was particularly interesting because it was my first opportunity to program an embedded platform.</p><h3 id="sensor-board">Sensor Board</h3><p>Alex has assembled boards such as the one below.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/gas_detector/board.png" alt="png" /></p><p>A board comprises 4 components:</p><ul><li>An ESP32 microcontroller running micropython and with Wi-Fi connectivity (black).</li><li>A gas sensor whose electric resistance varies with gas concentration in the air (grey).</li><li>An analog-digital converter that measures the sensor’s resistance and reports to the ESP32 using the I2C communication protocol (blue).</li><li>A micro USB connector to power all above components.</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/gas_detector/smell_detector_electrical.png" alt="png" /></p><h3 id="electrical-wiring-of-the-sensor">Electrical Wiring of the Sensor</h3><p>The electrical schema above shows the sensor has three connectors. So how exactly does it work ? The sensor itself has two components :</p><ul><li>An internal resistor (not shown) connected to <strong><em>VCC</em></strong> and <strong><em>GND</em></strong> that heats up.</li><li>A metal oxide plate, connected to <strong><em>VCC</em></strong> and the green pin - but not ground. When heated, the resistance and thus also the voltage drop at the plate varies with the gas concentration.</li></ul><p>Also note the presence of another resistor outside of the sensor. It is used to make a voltage divider to protect the ADC converter from being exposed to a high voltage.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/gas_detector/voltage_divider.png" alt="png" /></p><ul><li>From ohm’s low, Va = Rs * I.</li><li>Vcc = (Rr+Rs) x I ==&gt; I = Vcc / (Rr+Rs).</li><li>Hence, Va = Rs / (Rr+Rs) * Vcc, and the bigger Rr, the smaller Va compared to Vcc.</li></ul><h3 id="software">Software</h3><p>Recall that we want to scatter several sensor boards across Alex’s office, then collect and visualize data. In the architecture schema below, boards connect to Wi-Fi and send data to a server running on a raspberry pi. The server writes data to an InfluxDB database made for time series. We use Grafana, an interactive visualization web application, to display information to users.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/gas_detector/software_architecture.png" alt="png" /></p><p>The sensor boards have to sample data, send the data, and listen to the server for updates in the sampling parameters such as the sampling frequency or batch size. However, with a single CPU core, the ESP32 is only able to perform one task at a time. In the next section, we explain how we used concurrent programming to solve this paradox.</p><h3 id="concurrent-programming-with-coroutines">Concurrent Programming with Coroutines</h3><p>Sampling, sending or receiving data are IO-bound operations: the CPU will spend a large amount of time waiting for events, such the expiry of a sampling timer, or a TCP acknowledgment. Instead of performing these tasks sequentially, we used concurrent programming to allow the CPU to switch to another task while one is waiting for an IO event. We implemented our sensor program using micropython’s uasyncio library, a port of python’s asyncio library.<br /> The library allows the definition of <em>coroutines</em>, functions that will at some point wait for an IO event and temporarily release the CPU. Couroutine definitions are prefixed with <em>async</em>, and the function body contains an <em>await</em> statement. Asyncio’s <em>create_task</em> functions allows to schedule the execution of a corountine. For what it’s worth, one can think of the relationship between coroutines and tasks as the relationship between classes and objects.</p><p>The main first creates a task that polls the ADC and sends data to the raspberry. Then it creates a second task that continuously waits for parameter updates from the raspberry. An update triggers the execution of another polling task.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">sensor</span><span class="o">=</span><span class="n">Sensor</span><span class="p">()</span>

    <span class="c1">#start sending data to rasp
</span>    <span class="n">uasyncio</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">sensor</span><span class="p">.</span><span class="n">poll</span><span class="p">(</span><span class="n">nsamples</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">period_ms</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span> 
    
    <span class="c1">#wait for further instructions from raspberry
</span>    <span class="n">server</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="p">.</span><span class="n">stream</span><span class="p">.</span><span class="n">Server</span><span class="p">()</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">_serve</span><span class="p">(</span><span class="n">sensor</span><span class="p">.</span><span class="n">poll</span><span class="p">,</span> <span class="s">'192.168.20.55'</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="n">backlog</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="k">await</span> <span class="n">task</span>
</pre></table></code></div></div><p>The poll task first checks whether or not it has to stop in the case where another identical task is already running. Then it samples data, and releases the CPU between successive samplings. After collecting a batch of samples, the task creates a <em>send_data</em> task. This way, the sampling task and the sending task make use of each other’ wait times.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Sensor</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">period_ms</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c1"># Check if an identical coroutine is not already running.
</span>        <span class="c1"># In case client keeps polling with the same parameters
</span>        <span class="c1"># we don't want to send duplicate data
</span>        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_params</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">period_ms</span><span class="p">,</span> <span class="n">continuous</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"such co-routine is already running, exiting"</span><span class="p">)</span>
            <span class="k">return</span> 
        <span class="bp">self</span><span class="p">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">period_ms</span><span class="p">,</span> <span class="n">continuous</span><span class="p">)</span>
        <span class="n">pending</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="bp">True</span> <span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
                <span class="n">samples</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sample</span><span class="p">())</span>
                <span class="k">await</span> <span class="n">uasyncio</span><span class="p">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="n">period_ms</span> <span class="k">if</span> <span class="p">((</span><span class="n">nsamples</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">continuous</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pending</span> <span class="p">:</span> <span class="k">await</span> <span class="n">pending</span> <span class="c1">#wait transmission of previous batch
</span>            <span class="n">pending</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">send_data</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span> <span class="c1">#transmit current batch
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">continuous</span> <span class="p">:</span> 
                <span class="k">print</span><span class="p">(</span><span class="s">"batched finished, exiting"</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_params</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">period_ms</span><span class="p">,</span> <span class="n">continuous</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"params have changed, exiting"</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">pending</span><span class="p">:</span> <span class="k">await</span> <span class="n">pending</span>
</pre></table></code></div></div><h3 id="visualization">Visualization</h3><h3 id="conclusion">Conclusion</h3><p>This project has been a great opportunity to develop an IoT application from hardware to software. I’ve learned to program a microcontroller, deepen my knowledge of electrical components and use concurrent programming to optimize IO efficiency.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tech/'>tech</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tech/" class="post-tag no-text-decoration" >tech</a> <a href="/tags/hardware/" class="post-tag no-text-decoration" >hardware</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Making a gas detector - Chirpy&url=https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Making a gas detector - Chirpy&u=https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Making a gas detector - Chirpy&url=https://lperennou.github.io/posts/assembling-and-programming-a-gas-detector/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/summer-weather/">여름 날씨</a></li><li><a href="/posts/motivation/">한국어 배우기 동기</a></li><li><a href="/posts/career/">경력 진행되는 방법</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/trading/">trading</a> <a class="post-tag" href="/tags/commodities/">commodities</a> <a class="post-tag" href="/tags/tech/">tech</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/equities/">equities</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/value-VS-growth/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 28 <i class="unloaded">2020-09-28T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>value VS growth</h3><div class="text-muted small"><p> In this post, we compare two competing investment strategies: growth and value. “Growth” compagnies are those expected to grow faster than the rest and generate big cash flows in the future. “Val...</p></div></div></a></div><div class="card"> <a href="/posts/health/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 29 <i class="unloaded">2020-08-29T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>치료를 받고 건강을 지키는 방법</h3><div class="text-muted small"><p> 한국어로 형과 나는 어렸을 때, 매우 활동적이었다. 우리가 몇번 다쳤다. 어느 날 형이 나무에 올아가다가 넘어졌더니 팔이 부러졌다. 우리가 형에게 치료를 주려고 내과에 갔다. 의사 선생님이 형을 진찰을 한 다음에 수술을 해야 한다고 했다. 4시간 후에 우리가 간호사에게 형 수술을 잘 진행된지 물어 봤더니 간호사가 우리 형이 잘 일어났다고 했다. ...</p></div></div></a></div><div class="card"> <a href="/posts/summer-weather/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 28 <i class="unloaded">2020-08-28T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>여름 날씨</h3><div class="text-muted small"><p> 한국어로 지금 한국에 전국적으로 복날 이다. 밤 최저 기온은 25도 인데, 낮 최고 기온은 33도 이다. 낮에 보통 안개가 끼고 날씨가 흐리다. 밖에 나가면 우산을 가지고 가는 게 나을 거다. 가방을 멜때 우산을 꼭 잊어버리지 마. 안개 때문에 창 빡으로 아무것도 볼 수 없다. 비가 안 오면 해가 뜰때 부터 햇빛이 강하다. 방에 큰 창문이 ...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/energy-etfs/" class="btn btn-outline-primary"><p>I wish I knew about contango before buying an oil ETF</p></a> <a href="/posts/motivation/" class="btn btn-outline-primary"><p>한국어 배우기 동기</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/username">your_full_name</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/trading/">trading</a> <a class="post-tag" href="/tags/commodities/">commodities</a> <a class="post-tag" href="/tags/tech/">tech</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/equities/">equities</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://lperennou.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
